# Cross-Validationè¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

> [!IMPORTANT]
> ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯CVè¨­è¨ˆã®æ ¹æ‹ ã¨å®Ÿè£…æ–¹é‡ã‚’è¨˜è¼‰ã™ã‚‹ã€‚

---

## 1. ãƒ‡ãƒ¼ã‚¿æ¦‚è¦

### è¨“ç·´ãƒ‡ãƒ¼ã‚¿
| é …ç›® | å€¤ |
|------|-----|
| ã‚µãƒ³ãƒ—ãƒ«æ•° | 1,200 |
| ã‚«ãƒ†ã‚´ãƒª | A, B, C |
| ã‚«ãƒ†ã‚´ãƒªåˆ†å¸ƒ | **å®Œå…¨å‡ç­‰** (400:400:400) |

### ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
| é …ç›® | å€¤ |
|------|-----|
| ã‚µãƒ³ãƒ—ãƒ«æ•° | 300 |
| ã‚«ãƒ†ã‚´ãƒªæƒ…å ± | **ãªã—ï¼ˆéå…¬é–‹ï¼‰** |

---

## 2. ã‚«ãƒ†ã‚´ãƒªç‰¹æ€§åˆ†æ

### 2.1 INPUTç”»åƒï¼ˆé€éå…‰ç”»åƒï¼‰

| ã‚«ãƒ†ã‚´ãƒª | å¹³å‡è¼åº¦ | ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ(std) | ç‰¹å¾´ |
|---------|---------|------------------|------|
| A | 78.91 Â± 8.05 | 80.48 Â± 9.38 | æ˜ã‚‹ãé«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ |
| B | 76.76 Â± 8.33 | 80.69 Â± 8.46 | Aã«é¡ä¼¼ |
| **C** | **66.46 Â± 7.50** | **70.15 Â± 8.31** | **æš—ãä½ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ** |

### 2.2 TARGETç”»åƒï¼ˆè›å…‰ç”»åƒï¼‰

| ã‚«ãƒ†ã‚´ãƒª | å¹³å‡è¼åº¦ | ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ(std) | ç‰¹å¾´ |
|---------|---------|------------------|------|
| **A** | 48.43 Â± 6.07 | **92.36 Â± 5.19** | **æœ€ã‚‚æ§‹é€ ãŒã¯ã£ãã‚Š** |
| B | 45.18 Â± 7.14 | 82.78 Â± 5.59 | ä¸­é–“çš„ |
| **C** | 46.23 Â± 10.28 | **66.71 Â± 13.95** | **ä½ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã€ã°ã‚‰ã¤ãå¤§** |

### 2.3 å¤‰æ›ã®è¤‡é›‘ã•ï¼ˆINPUTâ†’TARGETï¼‰

| ã‚«ãƒ†ã‚´ãƒª | è¼åº¦ã‚·ãƒ•ãƒˆ | ç¯„å›² | è§£é‡ˆ |
|---------|-----------|------|------|
| A | -30.48 Â± 12.88 | [-57, -2] | å®‰å®šã—ãŸå¤‰æ› |
| B | -31.59 Â± 14.10 | [-60, +9] | ã‚„ã‚„ä¸å®‰å®š |
| **C** | -20.24 Â± 14.57 | [-61, +5] | **å¤‰æ›ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå¤šæ§˜** |

---

## 3. é›£æ˜“åº¦è©•ä¾¡

```
æ˜“ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ é›£
     A          B          C
```

| ã‚«ãƒ†ã‚´ãƒª | é›£æ˜“åº¦ | ç†ç”± |
|---------|--------|------|
| **A** | ğŸŸ¢ æ˜“ | é«˜ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã€å®‰å®šã—ãŸå¤‰æ›ãƒ‘ã‚¿ãƒ¼ãƒ³ |
| **B** | ğŸŸ¡ ä¸­ | ä¸­é–“çš„ãªç‰¹æ€§ |
| **C** | ğŸ”´ é›£ | ä½ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã€å¤‰æ›ã°ã‚‰ã¤ãå¤§ã€äºˆæ¸¬å›°é›£ |

> [!WARNING]
> Category C ã®æ€§èƒ½ãŒå…¨ä½“ã‚¹ã‚³ã‚¢ã®ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã«ãªã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã€‚

---

## 4. CVæˆ¦ç•¥

### 4.1 æ¨å¥¨æ‰‹æ³•: Stratified K-Fold

```python
from sklearn.model_selection import StratifiedKFold

skf = StratifiedKFold(n_splits=5, shuffle=True, random_state=42)

for fold, (train_idx, val_idx) in enumerate(skf.split(df, df['category'])):
    train_df = df.iloc[train_idx]  # 960 samples
    val_df = df.iloc[val_idx]      # 240 samples
    # å„fold: A:320, B:320, C:320 (train) / A:80, B:80, C:80 (val)
```

### 4.2 ãªãœStratifiedã‹ï¼Ÿ

| æ‰‹æ³• | ãƒ¡ãƒªãƒƒãƒˆ | ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ |
|------|---------|-----------|
| Random Split | ã‚·ãƒ³ãƒ—ãƒ« | ã‚«ãƒ†ã‚´ãƒªåã‚Šã®ãƒªã‚¹ã‚¯ |
| **Stratified K-Fold** | **ã‚«ãƒ†ã‚´ãƒªæ¯”ç‡ç¶­æŒ** | ã‚„ã‚„è¤‡é›‘ |
| Group K-Fold | ã‚°ãƒ«ãƒ¼ãƒ—ãƒªãƒ¼ã‚¯é˜²æ­¢ | ã‚«ãƒ†ã‚´ãƒª = ã‚°ãƒ«ãƒ¼ãƒ—ã§ã¯ãªã„ |

### 4.3 Foldè¨­è¨ˆ

| Fold | Train | Validation |
|------|-------|------------|
| å„Foldå…±é€š | A:320 + B:320 + C:320 = 960 | A:80 + B:80 + C:80 = 240 |

---

## 5. å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [x] `train_notebook.py` ã‚’ Stratified K-Fold ã«å¤‰æ›´ â†’ `train_kfold()` é–¢æ•°è¿½åŠ 
- [x] ã‚«ãƒ†ã‚´ãƒªåˆ¥SSIM/PSNRæ¸¬å®šã‚’è¿½åŠ  â†’ `validate_with_categories()` é–¢æ•°è¿½åŠ 
- [x] å„foldã®çµæœã‚’è¨˜éŒ²ãƒ»å¹³å‡åŒ– â†’ `cv_results.json` ã¨ã—ã¦å‡ºåŠ›
- [ ] Category C ã®æ€§èƒ½ã‚’é‡ç‚¹ç›£è¦– â†’ å®Ÿé¨“å®Ÿè¡Œå¾Œã«æ¤œè¨¼

---

## 6. è©•ä¾¡æŒ‡æ¨™ã®æ‹¡å¼µ

### å®Ÿè£…æ¸ˆã¿: ã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒ¡ãƒˆãƒªã‚¯ã‚¹

```python
# kaggle/train_notebook.py ã® validate_with_categories() ã‚’å‚ç…§
# ä½¿ç”¨æ–¹æ³•:
#   N_FOLDS=5 python kaggle/train_notebook.py
#
# å‡ºåŠ›ä¾‹:
#   Val SSIM: 0.8650 (A:0.89, B:0.87, C:0.83)
#   Val PSNR: 28.50 (A:30.2, B:28.8, C:26.5)
```

---

## 7. æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

1. ~~**Stratified K-Foldå®Ÿè£…** â†’ `train_notebook.py` ä¿®æ­£~~ âœ… å®Œäº†
2. ~~**ã‚«ãƒ†ã‚´ãƒªåˆ¥è©•ä¾¡è¿½åŠ ** â†’ ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ç‰¹å®š~~ âœ… å®Œäº†
3. **Category C å¼·åŒ–ç­–æ¤œè¨** â†’ å°‚ç”¨Augmentationã€Loss weightèª¿æ•´

---

*æœ€çµ‚æ›´æ–°: 2026-01-07*

