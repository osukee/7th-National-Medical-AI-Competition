# Metrics 解釈ルール

## 評価指標の定義

### SSIM (Structural Similarity Index)

| 値域 | 解釈 | アクション |
|------|------|------------|
| 0.95 - 1.00 | 優秀 | 現状維持 or 微調整 |
| 0.90 - 0.95 | 良好 | 改善余地あり |
| 0.80 - 0.90 | 要改善 | アーキテクチャ見直し |
| < 0.80 | 不良 | 根本的な問題調査 |

### PSNR (Peak Signal-to-Noise Ratio)

| 値域 | 解釈 | アクション |
|------|------|------------|
| ≥ 40 dB | 優秀 | 現状維持 or 微調整 |
| 35-40 dB | 良好 | 改善余地あり |
| 30-35 dB | 要改善 | 損失関数・アーキテクチャ見直し |
| < 30 dB | 不良 | 根本的な問題調査 |

---

## 改善判断ルール

### 採用条件（以下のすべてを満たす）

1. SSIM が前回実験より **+0.005 以上**
2. PSNR が前回実験より **+0.5 dB 以上**
3. CIがすべてパス

### 却下条件（以下のいずれかに該当）

1. SSIM が前回実験より **-0.01 以下**
2. PSNR が前回実験より **-1 dB 以下**
3. CIが失敗

### 保留条件

上記のいずれにも該当しない場合は **保留** とし、追加検証を行う。

---

## CI失敗時の扱い

> [!CAUTION]
> **CI失敗 = 実験失敗** として扱う。例外なし。

### CI失敗の種類と対応

| 失敗タイプ | 対応 |
|------------|------|
| テスト失敗 | コード修正後に再実行 |
| タイムアウト | 計算量削減 or CI設定見直し |
| メモリ不足 | バッチサイズ削減 |
| 依存関係エラー | requirements.txt 更新 |

### 失敗実験の記録

CI失敗であっても `result.md` には以下を記録すること：

```markdown
## 結果

- **ステータス**: CI失敗
- **失敗理由**: [具体的なエラー内容]
- **学び**: [この失敗から得られた知見]
- **次のアクション**: [修正方針]
```

---

## 数値の信頼性

### 統計的有意性

- 単一の数値で判断しない
- 可能であれば複数回実行して平均・標準偏差を確認
- Cross-validation の結果を優先

### 過学習の兆候

| 兆候 | 判断基準 |
|------|----------|
| 訓練SSIMとテストSSIMの乖離 | 差が0.05以上なら要注意 |
| 訓練損失の急激な低下 | テスト損失が追従しない場合は過学習 |

---

## metrics.json フォーマット

CIが生成する `metrics.json` の形式：

```json
{
  "experiment_id": "exp_001_baseline",
  "timestamp": "2024-01-01T12:00:00Z",
  "metrics": {
    "ssim": 0.8500,
    "psnr": 32.50,
    "ssim_std": 0.0100,
    "psnr_std": 0.50
  },
  "ci_status": "passed",
  "training_time_seconds": 3600,
  "gpu_memory_peak_mb": 8192
}
```
